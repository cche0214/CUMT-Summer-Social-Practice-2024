<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>中国矿业大学·E新向党实践团</title>

  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  <link rel="stylesheet" href="./css/comments.css">
  <link rel="stylesheet" href="./css/framework.css">
  
</head>
<body>
  <!-- 页面其他内容 -->
  <header>
    <img src="./images/矿大校徽校名.png" alt="">
    <span>&nbsp;&nbsp;红色攻城狮 ——“e新向党”实践团</span>
  </header>

  <nav>
    <a href="index.html">首页</a>
    <a href="ChinaMap.html">地图展示</a>
    <a href="redstoryindex.html">革命故事</a>
    <a href="newsindex.html">实践新闻</a>
    <a href="messageboard.html">感悟心得</a>
    <a href="contractus.html">关于本站</a>
    <a href="comments.html" class="active">意见留言</a>
  </nav>
  <!-- 评论容器 -->
  <div id="gitalk-container"></div>

  <div class="footer">
    <p>
        联系电话：13832379532&nbsp;电子信箱：08232716@cumt.edu.cn&nbsp;中国矿业大学·E心向党社会实践版权所有
    </p>
</div>

<script>
  const gitalk = new Gitalk({
    clientID: 'Ov23ct32Klst4n5NyZJj', // 替换为你的 Client ID
    clientSecret: '', // 通过无服务器函数处理
    repo: 'CUMT-Summer-Social-Practice-2024', // 你的 GitHub 仓库名
    owner: 'cche0214', // 你的 GitHub 用户名
    admin: ['cche0214'], // 管理员用户名
    id: location.pathname, // 确保唯一性且长度小于 50
    distractionFreeMode: false // 是否启用全屏模式
  });
  gitalk.render('gitalk-container');

  // 使用无服务器函数来处理 GitHub OAuth 流程
  async function authenticateWithGitHub() {
    try {
      const code = new URL(window.location.href).searchParams.get("code");
      if (code) {
        const response = await fetch('/api/comment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ code }),
        });
        const data = await response.json();
        if (response.ok) {
          console.log('Access Token:', data.access_token);
          // 设置 Gitalk 的访问令牌
          gitalk.accessToken = data.access_token;
          gitalk.render('gitalk-container');
        } else {
          console.error('Error:', data.error);
        }
      }
    } catch (error) {
      console.error('Network Error:', error);
    }
  }

  // 调用 authenticateWithGitHub 函数来处理 OAuth 过程
  authenticateWithGitHub();
</script>

</body>
</html>
